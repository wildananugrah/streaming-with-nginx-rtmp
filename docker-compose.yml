services:
  nginx-rtmp:
    image: tiangolo/nginx-rtmp
    container_name: nginx-rtmp
    ports:
      - "1935:1935"   # RTMP ingest
      - "8083:80"     # HLS playback (HTTP)
      - "8443:443"    # HLS playback (HTTPS)
    volumes:
      # Custom nginx config with CORS
      - ./configs/nginx.conf:/etc/nginx/nginx.conf:ro

      # SSL certificates (copy from Let's Encrypt or create self-signed)
      - /etc/letsencrypt/live/stream.mhamzah.id/fullchain.pem:/etc/nginx/ssl/fullchain.pem:ro
      - /etc/letsencrypt/live/stream.mhamzah.id/privkey.pem:/etc/nginx/ssl/privkey.pem:ro

      # Persist HLS segments on host
      - ./hls:/tmp/hls

      # Optional: Persist recordings on host
      - ./recordings:/var/recordings
    restart: unless-stopped

# Usage:
# 1. Start:    docker-compose up -d
# 2. Stop:     docker-compose down
# 3. Logs:     docker-compose logs -f
#
# Stream to:   rtmp://localhost/live/test
# Watch at:    http://localhost:8080/hls/test.m3u8
